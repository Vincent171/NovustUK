<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>UK AI Tax Assistant</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
  <!-- Loading Spinner Overlay -->
  <div id="overlay">
    <div class="spinner"></div>
    <p id="live-timer">⏱️ 0.00s</p>
  </div>

  <div class="header">
    <img src="logo.png" alt="Novust Logo" class="logo-crop" />
    <p class="subtext">Here to help as your AI Accountant. Ask away.</p>
  </div>

  <textarea id="questionInput" rows="5" placeholder="e.g. How much tax will I pay on £30k income?
How much national insurance do I pay on my self-employment?
What is the BIK on my electric car?
Are petrol expenses tax deductible?"></textarea>

  <div style="text-align: center;">
    <button id="askBtn" onclick="askQuestion()">Ask</button>
  </div>

  <div id="answer-box">
    <div id="response">
      <div id="answer-text"></div>
      <button onclick="copyAnswer()" class="copy-btn">⧉ Copy</button>
    </div>
    <p id="timer"></p>
  </div>

  
  <script>
    /*BELOW IS ACTUAL API LINK
    let responseTimes = [];
    let timerInterval;

async function askQuestion() {
  const askBtn = document.getElementById("askBtn");
  askBtn.textContent = "Ask again";  // ✅ Changes label after first use
  
  const question = document.getElementById("questionInput").value;
  const responseBox = document.getElementById("answer-text");
  const timerText = document.getElementById("timer");
  const overlay = document.getElementById("overlay");
  const liveTimer = document.getElementById("live-timer");

  
  if (!question.trim()) {
    alert("Please enter a question first.");
    return;
  }

  responseBox.textContent = "";
  document.getElementById("answer-box").style.display = "block";
  overlay.style.display = "flex";

  let start = Date.now();
  let elapsed = 0;
  let timeoutTriggered = false;

  timerText.textContent = "";
  liveTimer.textContent = "⏱️ 0.00s";

  timerInterval = setInterval(() => {
    elapsed = ((Date.now() - start) / 1000).toFixed(2);
    liveTimer.textContent = `⏱️ ${elapsed}s`;

    if (elapsed >= 15 && !timeoutTriggered) {
      timeoutTriggered = true;
      clearInterval(timerInterval);
      overlay.style.display = "none";
      responseBox.textContent = "We experienced an unexpected error. Please try rewording your question or trying again.";
    }
  }, 100);

  try {
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 15000);

    const res = await fetch("https://novust-api.onrender.com/api/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question }),
      signal: controller.signal
    });

    clearTimeout(timeout);
    clearInterval(timerInterval);
    overlay.style.display = "none";

    if (!timeoutTriggered) {
      const data = await res.json();
      responseBox.textContent = data.answer;
      responseBox.classList.add("show");
      timerText.textContent = `⏱️ Response time: ${elapsed}s — Average today: 1.21s`;
    }
  } catch (err) {
    if (!timeoutTriggered) {
      clearInterval(timerInterval);
      overlay.style.display = "none";
      responseBox.textContent = "Apologies, our assistant ran into a problem. Please try again shortly.";
    }
  }
}


function copyAnswer() {
  const btn = document.querySelector(".copy-btn");
  const answerText = document.getElementById("answer-text").textContent;
  navigator.clipboard.writeText(answerText).then(() => {
    btn.classList.add("clicked");
    btn.textContent = "Copied!";
    setTimeout(() => {
      btn.classList.remove("clicked");
      btn.textContent = "⧉ Copy";
    }, 2000);
  });
}
*/

/*BELOW IS API DEACTIVATED*/


let responseTimes = [];
let timerInterval;

async function askQuestion() {
  const question = document.getElementById("questionInput").value.trim();
  const responseBox = document.getElementById("answer-text");
  const timerText = document.getElementById("timer");
  const overlay = document.getElementById("overlay");
  const liveTimer = document.getElementById("live-timer");
  const askButton = document.querySelector("button");

  if (!question) {
    alert("Please enter a question.");
    return;
  }

  responseBox.textContent = "";
  document.getElementById("answer-box").style.display = "block";

  overlay.style.display = "flex";
  let start = Date.now();
  let elapsed = 0;

  liveTimer.textContent = "⏱️ 0.00s";
  timerInterval = setInterval(() => {
    elapsed = ((Date.now() - start) / 1000).toFixed(2);
    liveTimer.textContent = `⏱️ ${elapsed}s`;
  }, 100);

  // --- Simulate 16s delay (longer than timeout)
  const fakeApiCall = () => new Promise(resolve =>
    setTimeout(() => resolve({ answer: "API deactivated by host. Please try again later." }), 16000)
  );

  // --- Timeout after 15s
  const timeout = new Promise((_, reject) =>
    setTimeout(() => reject(new Error("timeout")), 15000)
  );

  try {
    const result = await Promise.race([fakeApiCall(), timeout]);

    clearInterval(timerInterval);
    overlay.style.display = "none";

    const totalTime = parseFloat(elapsed);
    responseTimes.push(totalTime);
    const average = 1.21; // fixed value for now

    responseBox.textContent = result.answer;
    responseBox.classList.add("show");
    timerText.textContent = `⏱️ Response time: ${totalTime}s — Average today: ${average}s`;

    askButton.textContent = "Ask again";

  } catch (err) {
    clearInterval(timerInterval);
    overlay.style.display = "none";

    responseBox.textContent = "We experienced an unexpected error. Please try rewording your question or trying again.";
    responseBox.classList.add("show");

    timerText.textContent = "⏱️ Timed out at 15s";
  }
}
</script>

  </div>
</body>
</html>
